# Messie -献立AI- 開発仕様書

## 概要

| 項目 | 内容 |
|------|------|
| アプリ名 | Messie（メッシー） |
| コンセプト | 「今日何食べよう」を毎日解決する献立提案アプリ |
| 特徴 | 恐竜キャラ「メッシー」が冷蔵庫事情や履歴を把握して実用的な提案 |
| プラットフォーム | iOS / Android |

## 技術スタック

| 要素 | 技術 |
|------|------|
| フロントエンド | Flutter |
| バックエンド | Firebase (Firestore, Auth, Storage, Functions) |
| AI | Vertex AI Gemini 3 Flash |
| 画像生成 | Google Nanobanana |
| 状態管理 | Riverpod（推奨） |

## キャラクター：Messie

| 項目 | 内容 |
|------|------|
| モチーフ | 小型草食恐竜（首長竜系）、可愛くて洗練されたデザイン |
| 語尾 | 「〜っシー」 |
| 性格 | 有能・実用的・ちょっとドライ |
| スタンス | 感情より情報。褒めない、媚びない |

### セリフ例

```
- 「鶏もも肉そろそろ使い切りたいっシー。チキン南蛮どうっシー？」
- 「また唐揚げっシー？…まあ止めないけどっシー」
- 「今日は疲れてそうだから10分で作れるやつにしたっシー」
- 「昨日の鶏肉はまだあるっシー？柚子胡椒の唐揚げでキメるっシー」
- 「3日連続で中華だったから、今日は和食にしとくっシー」
```

### NGパターン（やらないこと）

- 過剰な褒め（「えらい！」「すごい！」）
- 感情の押し付け（「メッシーうれしい」）
- キャラの自己主張

---

## 画面構成

### 1. 献立提案画面（ホーム）

アプリ起動時のメイン画面。即座に今日の献立提案を表示。

```
┌────────────────────────────────┐
│                                │
│    ┌──────────────────────┐    │
│    │                      │    │
│    │    【 料理画像 】     │    │
│    │                      │    │
│    │  チキン南蛮          │    │
│    │  30分・約500円       │    │
│    └──────────────────────┘    │
│                                │
│         ↓ スワイプでレシピ     │
│                                │
│    ┌────────────────────┐      │
│    │ 鶏もも肉そろそろ    │      │
│    │ 使い切りたいっシー  │◜ ◝  │
│    │ チキン南蛮どうっシー│ 🦕  │
│    └────────────────────┘◟ ◞  │
│                                │
│    ┌──────────┬──────────┐     │
│    │揚げ物ヤダ│ 別の提案 │     │
│    └──────────┴──────────┘     │
│                                │
│  [献立]    [買物]    [記録]    │
└────────────────────────────────┘
```

#### 機能要件

- アプリ起動で即提案表示（待ち時間なし→事前生成 or キャッシュ）
- Messieが画面右下（または左下）から顔を出し、吹き出しでコメント
- 吹き出し直下にインタラクティブボタン
  - 「揚げ物ヤダ」「もっと簡単なの」「別の提案」など
  - タップで別の提案に切り替え
- 画面を下スワイプでレシピ詳細へ遷移

#### レシピ詳細（下スワイプ後）

```
┌────────────────────────────────┐
│ ← チキン南蛮                   │
├────────────────────────────────┤
│                                │
│    【 料理画像（大）】         │
│                                │
├────────────────────────────────┤
│ 材料（2人分）                  │
│                                │
│ ・[鶏もも肉] 300g              │
│ ・[卵] 2個                     │
│ ・[玉ねぎ] 1/2個               │
│ ・[酢] 大さじ2                 │
│ ・[砂糖] 大さじ1               │
│  ...                           │
│                                │
│ [買い物リストに追加]           │
├────────────────────────────────┤
│ 作り方                         │
│                                │
│ 1. 鶏肉を一口大に切り、塩胡椒  │
│    をふる                      │
│ 2. 溶き卵にくぐらせ、170度の   │
│    油で揚げる                  │
│ 3. ...                         │
│                                │
├────────────────────────────────┤
│        [これ作った！]          │
└────────────────────────────────┘
```

#### 食材タップ時のアクション

食材名をタップすると以下を選択可能：

- 「別の食材にする」→ 代替食材を提案
- 「メッシーに質問する」→ Premiumのみ（調理のコツなど聞ける）

---

### 2. 買い物リスト画面

```
┌────────────────────────────────┐
│ 買い物リスト                   │
├────────────────────────────────┤
│                                │
│ ☑ 鶏もも肉 300g               │
│ ☐ 卵 1パック                  │
│ ☐ 玉ねぎ 2個                  │
│ ☐ マヨネーズ                  │
│                                │
│ [+ 手動で追加]                 │
│                                │
├────────────────────────────────┤
│    ┌────────────────────┐      │
│    │ 卵は週末に安くなる │ 🦕   │
│    │ こと多いっシー     │      │
│    └────────────────────┘      │
│                                │
│  [献立]    [買物]    [記録]    │
└────────────────────────────────┘
```

#### 機能要件

- 手動で食材追加
- レシピ詳細から一括追加
- チェックで購入済み → 冷蔵庫在庫として内部的に記憶
- Messieの軽いコメント（任意、なくてもOK）

---

### 3. ごはんの記録画面

```
┌────────────────────────────────┐
│ ごはんの記録                   │
├────────────────────────────────┤
│                                │
│ 2025年1月                      │
│ ┌─────┬─────┬─────┬─────┐     │
│ │ 19  │ 20  │ 21  │ 22  │ ... │
│ │ 🍗  │ 🍝  │     │     │     │
│ └─────┴─────┴─────┴─────┘     │
│                                │
├────────────────────────────────┤
│ 最近の記録                     │
│                                │
│ ┌──────────┬─────────────────┐ │
│ │  [写真]  │ チキン南蛮      │ │
│ │          │ 1/19 夕食       │ │
│ └──────────┴─────────────────┘ │
│ ┌──────────┬─────────────────┐ │
│ │  [写真]  │ ナポリタン      │ │
│ │          │ 1/20 昼食       │ │
│ └──────────┴─────────────────┘ │
│                                │
│ [+ 記録を追加]                 │
│                                │
│  [献立]    [買物]    [記録]    │
└────────────────────────────────┘
```

#### 機能要件

- 提案から「これ作った」で簡単に記録追加
- 手動で記録追加も可能
- 写真は任意（なしでもOK）
- カレンダー表示で履歴を俯瞰
- 履歴データはMessieの提案ロジックに反映

---

## データモデル（Firestore）

### users

```javascript
users/{userId}
{
  uid: string,
  displayName: string,
  email: string,
  createdAt: timestamp,
  isPremium: boolean,
  premiumUntil: timestamp | null,
  settings: {
    servingSize: number,        // 何人分（1-6）
    dislikedIngredients: [],    // 苦手な食材
    dislikedCuisines: [],       // 苦手なジャンル
    cookingFrequency: string,   // "daily" | "often" | "sometimes"
  }
}
```

### recipes

```javascript
recipes/{recipeId}
{
  id: string,
  name: string,
  imageUrl: string,
  category: string,             // "main" | "side" | "soup" | "rice" | "noodle"
  cuisine: string,              // "japanese" | "western" | "chinese" | "korean" | "other"
  timeMinutes: number,
  costYen: number,
  difficulty: number,           // 1-3
  seasons: [],                  // ["spring", "summer", "fall", "winter"]
  calories: number | null,      // Premium機能用
  ingredients: [
    {
      name: string,
      amount: number,
      unit: string,
      isMain: boolean           // メイン食材フラグ
    }
  ],
  steps: [],
  tags: [],                     // ["時短", "節約", "ヘルシー", "作り置き"...]
  createdAt: timestamp
}
```

### mealRecords

```javascript
users/{userId}/mealRecords/{recordId}
{
  id: string,
  recipeId: string | null,      // レシピDBからの場合
  recipeName: string,           // 手入力の場合も対応
  imageUrl: string | null,
  mealType: string,             // "breakfast" | "lunch" | "dinner" | "snack"
  date: timestamp,
  createdAt: timestamp
}
```

### shoppingList

```javascript
users/{userId}/shoppingList/{itemId}
{
  id: string,
  name: string,
  amount: string,
  isPurchased: boolean,
  addedFrom: string | null,     // recipeId（どのレシピから追加されたか）
  createdAt: timestamp
}
```

### pantry（冷蔵庫在庫 - 推定）

```javascript
users/{userId}/pantry/{itemId}
{
  id: string,
  ingredientName: string,
  estimatedAmount: string,      // "ある" | "少し" | "なし"
  lastPurchased: timestamp,
  lastUsed: timestamp | null
}
```

### dailySuggestions（事前生成キャッシュ）

```javascript
users/{userId}/dailySuggestions/{date}
{
  date: string,                 // "2025-01-20"
  suggestions: [
    {
      recipeId: string,
      messieComment: string,
      reason: string            // 選定理由（内部用）
    }
  ],
  generatedAt: timestamp
}
```

---

## AIロジック（Vertex AI Gemini 3 Flash）

### 役割

AIは「レシピをゼロから生成」ではなく「レシピDBから選定 + コメント生成」に限定。

### 選定プロンプト例

```
あなたは献立提案アシスタント「メッシー」です。

## ユーザー情報
- 最近の食事履歴: ${recentMeals}
- 苦手な食材: ${dislikedIngredients}
- 冷蔵庫にありそうなもの: ${pantryItems}
- 人数: ${servingSize}人分
- 今日の曜日: ${dayOfWeek}
- 季節: ${season}

## レシピ候補
${recipeCandidates}

## タスク
1. 上記のレシピ候補から最適な1品を選んでください
2. 選定理由を簡潔に
3. メッシーとしての一言コメント（語尾は「〜っシー」）

## 出力形式（JSON）
{
  "selectedRecipeId": "xxx",
  "reason": "選定理由",
  "messieComment": "コメント"
}
```

### 「別の提案」時の追加条件

```
## 追加条件
- 除外するレシピID: ${excludedRecipeIds}
- ユーザーのフィードバック: ${feedback}  // "揚げ物ヤダ"など
```

---

## 料金プラン

| 機能 | Free | Premium |
|------|:----:|:-------:|
| 1日1献立提案 | ✅ | ✅ |
| 別の提案 | 1日3回 | 無制限 |
| 買い物リスト | ✅ | ✅ |
| ごはんの記録 | ✅ | ✅ |
| 家族人数設定 | ✅ | ✅ |
| 広告表示 | あり | なし |
| メッシーに質問 | - | ✅ |
| カロリー・栄養表示 | - | ✅ |

### 価格

- 月額: 400〜500円
- 年額: 4,000円（2ヶ月分お得）

### 実装

- RevenueCat または Firebase Extensions for Payments
- iOS: App Store In-App Purchase
- Android: Google Play Billing

---

## 広告

- Free版のみ表示
- 配置: 献立提案画面の下部（バナー）または画面遷移時（インタースティシャル、頻度控えめ）
- Google AdMob使用

---

## MVP（Phase 1）スコープ

### やること

- [ ] Firebase Auth（匿名認証 → 後からメール登録可能に）
- [ ] 献立提案画面（ホーム）
- [ ] レシピ詳細画面
- [ ] Messieのコメント表示
- [ ] レシピDB（Firestore）100件程度
- [ ] ごはんの記録（シンプル版）
- [ ] 基本的なUI/UXの実装

### やらないこと（Phase 2以降）

- 買い物リスト機能
- 冷蔵庫在庫管理
- Premium機能（課金）
- AI質問機能
- 広告実装
- プッシュ通知

---

## レシピDB構築方法

### 手順

1. カテゴリ・ジャンル別にリスト作成
2. Claude/GeminiブラウザでJSON形式で一括生成
3. スプレッドシートで軽くチェック（分量のおかしさなど）
4. Firestoreにインポート

### 生成プロンプト例

```
以下の形式で和食の主菜レシピを20個生成してください。JSON配列で出力。

{
  "name": "料理名",
  "category": "main",
  "cuisine": "japanese",
  "timeMinutes": 調理時間（分）,
  "costYen": 概算費用（円）,
  "difficulty": 1〜3,
  "seasons": ["spring", "summer", "fall", "winter"]から該当するもの,
  "calories": カロリー（kcal）,
  "ingredients": [
    {"name": "食材名", "amount": 数値, "unit": "単位", "isMain": true/false}
  ],
  "steps": ["手順1", "手順2", ...],
  "tags": ["時短", "節約", "ヘルシー"など該当するもの]
}

定番すぎる料理（カレー、ハンバーグ等）だけでなく、
少しひねりのあるレシピも含めてください。
```

### 目標件数（MVP）

| カテゴリ | 件数 |
|----------|------|
| 和食主菜 | 30 |
| 洋食主菜 | 25 |
| 中華主菜 | 20 |
| 副菜 | 15 |
| 汁物 | 10 |
| **合計** | **100** |

---

## その他検討事項

### 画像について

- レシピ画像はGoogle Nanobananaで生成
- ユーザーがアップロードした写真はFirebase Storageに保存

### オンボーディング

初回起動時に最低限の設定を収集：

1. 何人分の食事を作る？（1人 / 2人 / 3人以上）
2. 苦手な食材ある？（タップ選択）
3. 自炊頻度は？（毎日 / 週3-4 / たまに）

### プッシュ通知（将来）

- 「今日の献立決まったっシー」（朝）
- 「買い忘れない？」（夕方、買い物リストあれば）
